# POS â€“ Scripts de InstalaciÃ³n y ActualizaciÃ³n

Este repositorio contiene los scripts necesarios para **instalar, actualizar y mantener**
el sistema POS, compuesto por:

- **Frontend**: AplicaciÃ³n Electron distribuida como AppImage
- **Backend**: AplicaciÃ³n Spring Boot distribuida como JAR

âš ï¸ **Este repositorio NO contiene binarios**  
Los ejecutables se descargan automÃ¡ticamente desde **GitHub Releases**.

---

## ğŸ“ Estructura del proyecto

```text
/opt/pos/
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ pos-app            # AppImage (NO versionado)
â”‚   â”œâ”€â”€ version.txt        # VersiÃ³n instalada del frontend
â”‚   â”œâ”€â”€ update-frontend.sh
â”‚   â”œâ”€â”€ install.sh
â”‚   â””â”€â”€ uninstall.sh
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ pos-backend.jar    # JAR (NO versionado)
â”‚   â”œâ”€â”€ version.txt        # VersiÃ³n instalada del backend
â”‚   â””â”€â”€ update-backend.sh
â”œâ”€â”€ install.py             # InstalaciÃ³n inicial del sistema
â”œâ”€â”€ update.py              # ActualizaciÃ³n con interfaz visual
â””â”€â”€ README.md

---
```

## ğŸ–¥ï¸ Requisitos del sistema

Lubuntu / Ubuntu 20.04 o superior

curl

git

systemd

libfuse2

python3

## Instalar dependencias bÃ¡sicas:

sudo apt update
sudo apt install -y curl git libfuse2 python3
sudo apt install -y python3-pil python3-pil.imagetk


## ğŸš€ InstalaciÃ³n inicial (ingenieros de campo)
1ï¸âƒ£ Abrir terminal y entrar a /opt
cd /opt

2ï¸âƒ£ Clonar el repositorio
sudo git clone https://github.com/technoMaxa/pos.git

3ï¸âƒ£ Asignar permisos al usuario local

Sustituye POS por el usuario del equipo
(por ejemplo: fulano)

sudo chown -R POS:POS /opt/pos

4ï¸âƒ£ (Opcional) Abrir en Visual Studio Code
code /opt/pos

## ğŸ” Variables de entorno (OBLIGATORIO)

Los scripts utilizan tokens de solo lectura para consultar GitHub Releases.

Backend
sudo nano /etc/pos-backend.env


Contenido:

GITHUB_TOKEN=YOUR_GITHUB_READONLY_TOKEN


Permisos:

sudo chmod 600 /etc/pos-backend.env
sudo chown root:root /etc/pos-backend.env

Frontend
sudo nano /etc/pos-frontend.env


Contenido:

GITHUB_TOKEN=YOUR_GITHUB_READONLY_TOKEN


Permisos:

sudo chmod 600 /etc/pos-frontend.env
sudo chown root:root /etc/pos-frontend.env

## ğŸ§© InstalaciÃ³n inicial del sistema

chmod +x /opt/pos/frontend/update-frontend.sh
chmod +x /opt/pos/backend/update-backend.sh
chmod +x /opt/pos/frontend/install.sh 
chmod +x /opt/pos/frontend/uninstall.sh 


## âš ï¸ Este paso se ejecuta SOLO UNA VEZ por equipo

sudo python3 /opt/pos/install.py


Este proceso:

Descarga el frontend (AppImage)

Descarga el backend (JAR)

Crea la estructura /opt/pos

Deja el sistema listo para actualizaciones

ğŸ”„ ActualizaciÃ³n manual
Frontend
sudo /opt/pos/frontend/update-frontend.sh

Backend
sudo /opt/pos/backend/update-backend.sh

ğŸ¤– Actualizaciones automÃ¡ticas

El sistema soporta:

ğŸ” ActualizaciÃ³n automÃ¡tica cada 12 horas

ğŸ”„ ActualizaciÃ³n automÃ¡tica al reiniciar el equipo

## ğŸ–¥ï¸ Ventana visual para el usuario durante la descarga

Crear servicio systemd
**1ï¸âƒ£ Copiar archivos de servicio
sudo cp /opt/pos/systemd/pos-update.service /etc/systemd/system/
sudo cp /opt/pos/systemd/pos-update.timer /etc/systemd/system/

**2ï¸âƒ£ Recargar systemd
sudo systemctl daemon-reexec
sudo systemctl daemon-reload

**3ï¸âƒ£ Activar temporizador
sudo systemctl enable pos-update.timer
sudo systemctl start pos-update.timer

sudo cp /opt/pos/systemd/pos-backend.service /etc/systemd/system/
sudo chown root:root /etc/systemd/system/pos-backend.service
sudo chmod 644 /etc/systemd/system/pos-backend.service

sudo cp /opt/pos/systemd/backup-mysql.service /etc/systemd/system/
sudo cp /opt/pos/systemd/backup-mysql.timer /etc/systemd/system/

sudo systemctl daemon-reload
sudo systemctl enable backup-mysql.timer
sudo systemctl start backup-mysql.timer

systemctl list-timers | grep backup


## ConfiguraciÃ³n BD

sudo apt update
sudo apt upgrade -y

sudo apt install mysql-server -y

| AcciÃ³n           | Comando                        |
| ---------------- | ------------------------------ |
| Ver servicio     | `systemctl status mysql`       |
| Entrar como root | `sudo mysql`                   |
| Reiniciar        | `sudo systemctl restart mysql` |
| Logs             | `journalctl -u mysql`          |

base: tienda

## crear BD para la API

CREATE DATABASE tienda
  CHARACTER SET utf8mb4
  COLLATE utf8mb4_unicode_ci;



user: admin
pass: admin


## crear usuario para la API BD

CREATE USER 'api_user'@'localhost'
IDENTIFIED BY 'Un_Password_seguro90!';

GRANT ALL PRIVILEGES ON tienda.* TO 'api_user'@'localhost';
FLUSH PRIVILEGES;

EXIT;

## Cargar BD de la API 

mysql -u api_user -p tienda < /opt/pos/tienda/tienda.sql

## validar si se ejecuto 

mysql -u api_user -p tienda

SHOW TABLES;

Si ves tablas â†’ âœ… todo perfecto.

## Verificar permisos (opcional pero recomendado)

SHOW GRANTS FOR 'tienda_api'@'localhost';

## ğŸ‘¤ 3ï¸âƒ£ Usuario para backups (opcional pero recomendado)

CREATE USER 'backup_pos'@'localhost'
IDENTIFIED BY 'BackupPassword123!';

GRANT SELECT, LOCK TABLES, SHOW VIEW
ON tienda.* TO 'backup_pos'@'localhost';

FLUSH PRIVILEGES;

/opt/pos/bd/backup-mysql.sh

## ğŸ” Guardar contraseÃ±a sin exponerla

nano /root/.my.cnf
---
[client]
user=backup_pos
password=BackupPassword123!
host=localhost
---

sudo chmod 600 /root/.my.cnf




## ğŸ” 7ï¸âƒ£ Restaurar un backup (cuando lo necesites)

gunzip < tienda_2025-01-26_02-00.sql.gz | mysql -u tienda_api -p tienda

## ğŸ” Los tokens son solo lectura

## ğŸ“¦ Los binarios NO viven en Git

## ğŸ§  version.txt es la fuente de verdad

ğŸ› ï¸ Troubleshooting
Ver versiÃ³n instalada
cat /opt/pos/frontend/version.txt
cat /opt/pos/backend/version.txt

Forzar actualizaciÃ³n manual
sudo /opt/pos/frontend/update-frontend.sh
sudo /opt/pos/backend/update-backend.sh



Logs

Backend: /opt/pos/backend/logs/backend.log

Frontend: ejecutar desde terminal para ver salida

## ğŸ“Œ Notas finales

Este repositorio estÃ¡ diseÃ±ado para:

Instalaciones en campo

Actualizaciones seguras

OperaciÃ³n continua

Mantenimiento sencillo

Es un enfoque probado en sistemas POS, kioscos y terminales de autoservicio.

## ğŸ§  Contacto

Equipo **TechnoMÃ¤xÃ¤**  
ğŸ“§ techno.maxa@gmail.com
